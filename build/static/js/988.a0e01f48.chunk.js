"use strict";(self.webpackChunkweb_booking=self.webpackChunkweb_booking||[]).push([[988],{5596:function(e,s,t){t.r(s),t.d(s,{default:function(){return M}});var a=t(82728),i=t(76012),l=t(72791),n=t(19598),_=t(91523),r={container:"right_container__l7Q3-",head:"right_head__MJzmn",head_left:"right_head_left__YkzKl",head_left_back:"right_head_left_back__SDwlz",topic:"right_topic__K-z5s",topic_img:"right_topic_img__ErJSp",topic_name:"right_topic_name__Yo7XS",body:"right_body__UJaOK",messages:"right_messages__jYm1D",message:"right_message__qzFz2",message_head:"right_message_head__L2UXJ",avatar:"right_avatar__R29Y4",user_name:"right_user_name__N2-MM",create:"right_create__HwPOF",message_body:"right_message_body__bDXtq",message_body_cnt:"right_message_body_cnt__B3q6D",input_cnt:"right_input_cnt__IQ2+S",scroll_btn:"right_scroll_btn__DSaqR",scroll_btn_act:"right_scroll_btn_act__pT1Zn",ip_ctl:"right_ip_ctl__pquHN",ip_ctl_btn:"right_ip_ctl_btn__pyHwN",btn_send:"right_btn_send__YOsmR",text_area_cnt:"right_text_area_cnt__xyIxa",text_area:"right_text_area__rs1W6",load:"right_load__Xt-Ri",chatBubble:"right_chatBubble__iSX6l",typing:"right_typing__a6Sfb",dot:"right_dot__+KkvV",mercuryTypingAnimation:"right_mercuryTypingAnimation__pQNPk"},c=t(28162),o=t(20181),d=t(48398),h=t(14771),m=t(70279),g=t(32470),u=t(65553),p=t(72426),v=t.n(p),x=t(93859),j=t(13239),f=t(80184);const b=()=>{var e,s,t,i;const{echo:_}=(0,l.useContext)(m.Il),{USER:p}=(0,a.aC)(),v=(0,n.TH)(),x=(0,n.k6)(),j=v.pathname.split("/")[2],b=v.state,y=(0,l.useRef)(null),w=()=>{y.current&&y.current.scrollIntoView({behavior:"smooth"})},{response:I}=(0,a.YE)({API_URL:g.Z.ORG(null!==(e=null===b||void 0===b?void 0:b.organization_id)&&void 0!==e?e:0),enable:null===b||void 0===b?void 0:b.organization_id,dedupingInterval:u.oF}),M=(0,d.Tw)(null!==(s=null===b||void 0===b||null===(t=b.topic_user)||void 0===t?void 0:t.map((e=>{var s;return null===(s=e.user)||void 0===s?void 0:s.fullname})))&&void 0!==s?s:[]);let D=null===b||void 0===b?void 0:b.name;0!==(null===b||void 0===b||null===(i=b.name)||void 0===i?void 0:i.trim().length)&&null!==b&&void 0!==b&&b.name||(D=M.join(", "));const{resData:C,onLoadMore:T,totalItem:H}=(0,a.H9)({API_URL:"messages",enable:p&&j,keyPage:"p",params:{l:25,sort:"-created_at",topic_id:j},dedupingInterval:0}),Y=(0,a.W7)({rootMargin:"100px",threshold:.3},y),[B,Z]=(0,l.useState)([]),[z,A]=(0,l.useState)(!1);return(0,l.useEffect)((()=>{if(_&&p&&b&&I){let e=_.join(`ci.chat.${I.subdomain}.${j}`).subscribed((()=>{e.whisper("connected",{user:{id:p.id,fullname:p.fullname,avatar:p.avatar,current_platform:"MANAGER_WEB"},socketId:null===_||void 0===_?void 0:_.socketId()}),e.listenForWhisper("typing",(e=>{var s;A(null===e||void 0===e||null===(s=e.user)||void 0===s?void 0:s.isTyping)}))})).listen("MessagePosted",(e=>{p.id!==e.user_id&&(w(),Z((s=>-1===s.indexOf(e)?[e,...s]:s)))}))}return()=>{Z([])}}),[_,j,I]),(0,f.jsxs)("div",{className:r.container,children:[(0,f.jsx)("div",{className:r.head,children:(0,f.jsxs)("div",{className:r.head_left,children:[(0,f.jsx)(c.Rb,{onClick:()=>x.goBack(),className:r.head_left_back,icon:o.Z.chevronRightBlack}),(0,f.jsxs)("div",{className:r.topic,children:[(0,f.jsx)("div",{className:r.topic_img,children:(0,f.jsx)("img",{src:"",alt:""})}),(0,f.jsx)("div",{className:r.topic_name,children:D})]})]})}),(0,f.jsxs)("div",{id:"scrollableDiv",className:r.messages,children:[(0,f.jsx)("div",{ref:y,className:r.bottom}),(0,f.jsxs)(h.Z,{dataLength:C.length,next:()=>C.length<H&&T(),style:{display:"flex",flexDirection:"column-reverse"},inverse:!0,hasMore:!0,loader:C.length<H&&(0,f.jsx)(R,{}),scrollableTarget:"scrollableDiv",children:[z&&(0,f.jsx)(S,{}),(0,d.Cj)(B).concat(C).map(((e,s)=>(0,f.jsx)("div",{className:r.message,children:(0,f.jsx)(N,{item:e,change:e.user_id===p.id})},s)))]})]}),(0,f.jsx)(k,{setMsges:Z,topic_id:j,onScrollBottom:w,isInScreen:Y,org:I})]})},N=e=>{var s,t;let{item:a,change:i=!1}=e;return(0,f.jsxs)("div",{className:r.message_cnt,children:[(0,f.jsxs)("div",{className:r.message_head,style:i?{flexDirection:"row-reverse"}:{},children:[!i&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:r.avatar,children:(0,f.jsx)("img",{src:(null===(s=a.user)||void 0===s?void 0:s.avatar)||"",onError:d.A_,alt:""})}),(0,f.jsx)("span",{className:r.user_name,children:null===(t=a.user)||void 0===t?void 0:t.fullname})]}),(0,f.jsx)("span",{className:r.create,children:(0,d.wh)(a.created_at)})]}),(0,f.jsx)("div",{style:i?{flexDirection:"row-reverse"}:{},className:r.message_body,children:(0,f.jsx)("div",{style:i?{backgroundColor:"#f1faff",borderRadius:"8px 0px 8px 8px"}:{},className:r.message_body_cnt,dangerouslySetInnerHTML:{__html:(0,d.N1)(a.msg)}})})]})},y={_id:"",msg:"",user_id:0,topic_id:"",reply_id:null,updated_at:"",created_at:""},k=e=>{let{setMsges:s,topic_id:t,onScrollBottom:i,isInScreen:n,org:_}=e;const{USER:d}=(0,a.aC)(),[h,g]=(0,l.useState)(y),u=(0,l.useRef)(null),{echo:p}=(0,l.useContext)(m.Il),j=e=>{let s=null===p||void 0===p?void 0:p.join(`ci.chat.${_.subdomain}.${t}`);null===s||void 0===s||s.whisper("typing",{user:{id:d.id,fullname:d.fullname,avatar:d.avatar,isTyping:e},socketId:null===p||void 0===p?void 0:p.socketId()})};(0,l.useEffect)((()=>{u.current&&(u.current.style.height="auto",h.msg.length>0&&(u.current.style.height=u.current.scrollHeight+"px"))}),[h]);const b=async()=>{var e;h.msg.trim().length>0&&(s((e=>[{...h,_id:`${v()().format("YYYYMMDDHHmmss")}${v()().milliseconds()}`,user_id:null===d||void 0===d?void 0:d.id,created_at:v()().format("YYYY-MM-DD HH:mm:ss")},...e])),g(y),await x.x.postMessage({msg:h.msg,topic_id:t}),null===(e=u.current)||void 0===e||e.blur(),i())};return(0,f.jsxs)("div",{className:r.input_cnt,children:[(0,f.jsx)(c.Rb,{icon:o.Z.chevronRightBlack,className:n?r.scroll_btn:`${r.scroll_btn} ${r.scroll_btn_act}`,onClick:i}),(0,f.jsxs)("div",{className:r.ip_ctl,children:[(0,f.jsx)(c.Rb,{className:r.ip_ctl_btn,iconSize:24,icon:o.Z.plus}),(0,f.jsx)(c.Rb,{className:r.ip_ctl_btn,iconSize:16,icon:o.Z.imageWhite})]}),(0,f.jsxs)("div",{className:r.text_area_cnt,children:[(0,f.jsx)("textarea",{ref:u,onChange:e=>g({...h,msg:e.target.value}),value:h.msg,placeholder:"Aa",rows:1,className:r.text_area,onKeyDown:e=>{"Enter"===e.code&&(e.preventDefault(),b())},onFocus:()=>j(!0),onBlur:()=>j(!1)}),(0,f.jsx)(c.Rb,{className:r.btn_send,icon:h.msg.length>0?o.Z.sendWhite:o.Z.thumbUpWhite,iconSize:16,onClick:b})]})]})},R=()=>(0,f.jsxs)("div",{className:r.load,children:["\u0110ang t\u1ea3i...",(0,f.jsx)(j.Z,{size:14})]}),S=()=>(0,f.jsx)("div",{className:r.chatBubble,children:(0,f.jsxs)("div",{className:r.typing,children:[(0,f.jsx)("div",{className:r.dot}),(0,f.jsx)("div",{className:r.dot}),(0,f.jsx)("div",{className:r.dot})]})});var w={container:"message_container__AxLpV",left:"message_left__k4A+R",left_head:"message_left_head__T--mk",left_head_top:"message_left_head_top__TNK6L",left_head_txt:"message_left_head_txt__MsKN9",left_head_bot:"message_left_head_bot__gwXBX",left_body:"message_left_body__xLWq0",topic:"message_topic__bGPa4",topic_left_img:"message_topic_left_img__s85aR",topic_left_online:"message_topic_left_online__7lGks",topic_right:"message_topic_right__B9HX4",topic_name:"message_topic_name__VZ3tS",topic_message:"message_topic_message__Cxfkf",right:"message_right__T+jke",left_ch:"message_left_ch__pIzTj",right_ch:"message_right_ch__Yr32q"},I=t(47873);var M=function(){const{USER:e}=(0,a.aC)(),[s]=(0,l.useState)(i.cE),t=(0,n.TH)().pathname.split("/")[2],{resData:_,onLoadMore:r,totalItem:c}=(0,a.H9)({API_URL:"topics",enable:e,params:s,dedupingInterval:0});return(0,f.jsxs)("div",{className:w.container,children:[(0,f.jsxs)("div",{className:t?`${w.left} ${w.left_ch}`:w.left,children:[(0,f.jsxs)("div",{className:w.left_head,children:[(0,f.jsxs)("div",{className:w.left_head_top,children:[(0,f.jsx)("span",{className:w.left_head_txt,children:"Chat"}),(0,f.jsx)("div",{className:w.left_head_ctl})]}),(0,f.jsxs)("div",{className:w.left_head_bot,children:[(0,f.jsx)("img",{src:o.Z.searchGray,alt:""}),(0,f.jsx)("input",{type:"text",placeholder:"T\xecm ki\u1ebfm trong tin nh\u1eafn..."})]})]}),(0,f.jsx)("div",{className:w.left_body,children:(0,f.jsx)(h.Z,{hasMore:!0,height:"calc(100vh - 172px)",dataLength:_.length,loader:_.length<c&&(0,f.jsx)(R,{}),next:()=>{_.length<c&&r()},children:(0,f.jsx)("ul",{className:w.topic_list,children:_.map((e=>(0,f.jsx)("li",{className:w.topic_cnt,children:(0,f.jsx)(D,{item:e})},e._id)))})})})]}),(0,f.jsx)(n.rs,{children:(0,f.jsx)(I.Z,{children:(0,f.jsx)(n.AW,{path:"/messages/:_id",children:(0,f.jsx)("div",{style:{backgroundColor:"var(--white)"},className:t?`${w.right} ${w.right_ch}`:w.right,children:(0,f.jsx)(b,{})})})})})]})};const D=e=>{var s,t,a,i;let{item:l}=e;const r=(0,n.TH)();let c=l.name;var o;0!==(null===(s=l.name)||void 0===s?void 0:s.trim().length)&&l.name||(c=(0,d.Tw)(null===(o=l.topic_user)||void 0===o?void 0:o.map((e=>{var s;return null===(s=e.user)||void 0===s?void 0:s.fullname})).filter(Boolean)).join(", "));const h=r.pathname.split("/")[2];return(0,f.jsxs)(_.rU,{style:l._id===h?{backgroundColor:"var(--bg-color)"}:{},to:{pathname:`/messages/${l._id}`,state:l},className:w.topic,children:[(0,f.jsx)("div",{className:w.topic_left,children:(0,f.jsxs)("div",{className:w.topic_left_img,children:[(0,f.jsx)("img",{src:(null===(t=l.topic_user[0])||void 0===t||null===(a=t.user)||void 0===a?void 0:a.avatar)||"",onError:d.A_,alt:""}),(0,f.jsx)("span",{className:w.topic_left_online})]})}),(0,f.jsxs)("div",{className:w.topic_right,children:[(0,f.jsx)("span",{className:w.topic_name,children:c}),(0,f.jsxs)("div",{className:w.topic_message,children:[(0,f.jsx)("span",{children:null===(i=l.messages[0])||void 0===i?void 0:i.msg}),(0,f.jsx)("span",{children:(0,d.wh)(l.updated_at)})]})]})]})}}}]);
//# sourceMappingURL=988.a0e01f48.chunk.js.map