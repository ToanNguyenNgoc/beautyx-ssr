"use strict";var _package=_interopRequireDefault(require("./package.json"));Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var ApiBase=/*#__PURE__*/function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"addHost",value:function addHost(a){var b,c=!1;if(this.hosts=null===(b=this.hosts)||void 0===b?void 0:b.map(function(b){var d=b,e=d.hostId;return e==a.hostId&&(c=!0,b=_objectSpread(_objectSpread({},b),a)),b}),!c){var d;this.hosts=null!==(d=this.hosts)&&void 0!==d?d:[],this.hosts.push(a)}}},{key:"removeHost",value:function removeHost(a){var b;this.hosts=null===(b=this.hosts)||void 0===b?void 0:b.filter(function(b){var c=b.hostId;return c!=a.hostId})}},{key:"currentHost",get:function get(){var a;if(0<(null===(a=this.hosts)||void 0===a?void 0:a.length)){var b=this.hosts[this.hosts.length-1];return b}return{}}},{key:"verifyResponse",value:function verifyResponse(a){var b=a.miniApp;return!!b}/** onMessage Receive event from App */},{key:"response",value:function(a){try{var b=JSON.parse(a);if(b&&this.verifyResponse(b)){var c=b.uuid,d=b.result,e=b.func,f=b.isListening,g=this.callbacks[c];if(g){try{if("object"===_typeof(d))g(d);else{var h=JSON.parse(d||"");h?g(h):g(d)}}catch(a){g(d)}if(0===e.indexOf("observerUploadDocuments")||f)return;"removeCallback"==e?this.callbacks&&this.callbacks[c]&&delete this.callbacks[c]:this.removeCallback(c)}}}catch(a){}}/** postMessage post Message to Application */},{key:"removeCallback",value:function removeCallback(a){this.dispatchFunction("removeCallback",a),this.callbacks&&this.callbacks[a]&&delete this.callbacks[a]}},{key:"dispatch",value:function dispatch(){var a=this,b=null,c=Array.from(arguments),d=c[0];if(c.shift(),0<c.length){var e=c[c.length-1];"function"==typeof e&&(b=e,c.pop())}var f=this.getUniqueId();this.callbacks||(this.callbacks={}),b&&(this.callbacks[f]=b);var g=_package["default"].apiVersion,h=this.currentHost,i={func:d,args:c,uuid:f,platform:this.platform,apiVersion:g,miniApp:h};return this.request(i,b),{remove:function remove(){a.removeCallback(f)}}}},{key:"request",value:function request(){}},{key:"getUniqueId",value:function getUniqueId(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}},{key:"dispatchFunction",value:function dispatchFunction(){// const instance = ApiBase.instance;
// if (!instance) {
//     console.logError("ApiBase haven't initialized yet!");
//     return;
// }
return this.dispatch.apply(this,arguments)}}],[{key:"init",value:function init(b){var c,d=(null===b||void 0===b||null===(c=b.client)||void 0===c?void 0:c.web)||b||{},e=d.appId;return a.instances[e]||(a.instances[e]=new this(d)),a.instances[e].addHost(d),global.miniAppApi=a.instances[e],a.instances[e]}}]),a}();exports["default"]=ApiBase,_defineProperty(ApiBase,"instances",{}),_defineProperty(ApiBase,"hosts",[]);